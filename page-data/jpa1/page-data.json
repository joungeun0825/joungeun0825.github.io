{"componentChunkName":"component---src-templates-post-jsx","path":"/jpa1/","result":{"data":{"site":{"siteMetadata":{"title":"mythofsummer"}},"markdownRemark":{"id":"926b5e59-e6c2-5645-8db2-7def69c806e4","excerpt":"JPA를 사용해 객체 간 관계를 설정하는 부분을 구현하다가 객체 변경 시 save() 메서드를 호출해야 하는지에 대한 의문이 들었습니다. 결론부터 말하자면 호출하지 않아도 됩니다. 이게 다 영속성 컨텍스트의 변경 감지(dirty checking) 특성 덕분입니다. 이번 글에서는 이러한 영속성 컨텍스트의 장점들을 알아보겠습니다. 영속성 컨텍스트란? 영속성 …","html":"<p>JPA를 사용해 객체 간 관계를 설정하는 부분을 구현하다가 <strong>객체 변경 시 save() 메서드를 호출해야 하는지</strong>에 대한 의문이 들었습니다. 결론부터 말하자면 <strong>호출하지 않아도 됩니다.</strong></p>\n<p>이게 다 영속성 컨텍스트의 <strong>변경 감지(dirty checking)</strong> 특성 덕분입니다. 이번 글에서는 이러한 영속성 컨텍스트의 장점들을 알아보겠습니다.</p>\n<h2 id=\"영속성-컨텍스트란\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%9E%80\" aria-label=\"영속성 컨텍스트란 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>영속성 컨텍스트란?</h2>\n<p>영속성 컨텍스트는 엔티티를 영구적으로 저장하는 논리적인 환경입니다. 쉽게 말해, 애플리케이션과 DB 사이의 중간 계층 역할을 하죠. 엔티티 매니저(Entity Manager)가 영속성 컨텍스트를 관리하며, 이를 통해 엔티티 상태를 추적하고 관리합니다.</p>\n<p>일반적으로 EntityManager.persist() 메서드를 호출하면 객체가 DB에 저장된다고 생각할 수 있지만, 실제로는 영속성 컨텍스트에서 관리되기 시작한 것입니다. 실제 DB에 쿼리가 날아가는 시점은 트랜잭션이 커밋될 때입니다.</p>\n<h2 id=\"영속성-컨텍스트의-주요-특성\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%EC%A3%BC%EC%9A%94-%ED%8A%B9%EC%84%B1\" aria-label=\"영속성 컨텍스트의 주요 특성 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>영속성 컨텍스트의 주요 특성</h2>\n<p>영속성 컨텍스트의 주요 특성 몇 가지를 알아보겠습니다.</p>\n<h3 id=\"변경-감지-Dirty-Checking\" style=\"position:relative;\"><a href=\"#%EB%B3%80%EA%B2%BD-%EA%B0%90%EC%A7%80-Dirty-Checking\" aria-label=\"변경 감지 Dirty Checking permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>변경 감지 (Dirty Checking)</h3>\n<p>앞에서 말했던 변경 감지입니다. JPA의 핵심 기능 중 하나인 변경 감지는 영속성 컨텍스트가 관리하는 엔티티의 변경사항을 자동으로 감지합니다. 트랜잭션 커밋 시점에 JPA는 영속성 컨텍스트에 있는 엔티티와 <strong>스냅샷(최초 영속 상태의 엔티티 상태)</strong>을 비교하여 변경된 부분이 있으면 업데이트 쿼리를 쓰기 지연 sql 저장소에 넣고, DB에 반영하고 커밋합니다. <strong>이를 통해 객체의 변경 사항을 별도로 save() 호출 없이도 처리할 수 있습니다.</strong>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8d91fa83f1f2e85b4d5f34c6833e8336/84a58/image-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABJ0AAASdAHeZh94AAABgElEQVR42m2TW6+CQAyE+f8/jBeeNAYFAa+IXBS8iyHUfE1KjieQNLuw7XRmujiPx0PqupbL5SLX61XyPJf1ei2bzUZ2u51st1tdyeGcPPZt28rY45B0u9004fP5SFVVslqtFDRNU91HUSRN02je+/1W4OfzqQB93/8C3u93Tc6yTIv3+70cj0c5nU7KtixLZTWfzwcFNH29XuMMoZ8kiQIBejgcdIUdURTFwJRGBE1gOsqQ4iAIZLlcCmyRgq/II/gGAIwBZ09TVBlw13WaS51jBQDGcSxhGMpisVAmSOUceXjMimwkm8eAn89n/Ua+AzLdkM4hEyXZpAMAMywhDxYUQoIavCWPPVjKEDZ0831fpVHsed7AdDKZiOu6mmNDtOtFMANY0lwBzXg6wQCWyOcuAo7H0+lU97CAIWF+M5gfDwEk6Mq7ATJZ9rPZTBnzzrmB2ZT/Tlo9NI/MJ1ZjCGv+FmQh3zz/f7ENWBkyANgBDACFvNu9s2+sFvxVYxf7C74ViVaayb/RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 1' title='' src='/static/8d91fa83f1f2e85b4d5f34c6833e8336/ca1dc/image-1.png' srcset='/static/8d91fa83f1f2e85b4d5f34c6833e8336/e7570/image-1.png 170w,\n/static/8d91fa83f1f2e85b4d5f34c6833e8336/f46e7/image-1.png 340w,\n/static/8d91fa83f1f2e85b4d5f34c6833e8336/ca1dc/image-1.png 680w,\n/static/8d91fa83f1f2e85b4d5f34c6833e8336/84a58/image-1.png 972w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3 id=\"1차-캐시\" style=\"position:relative;\"><a href=\"#1%EC%B0%A8-%EC%BA%90%EC%8B%9C\" aria-label=\"1차 캐시 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>1차 캐시</h3>\n<p>영속성 컨텍스트는 1차 캐시를 가지고 있습니다. 엔티티를 영속화하면 DB에 바로 저장되는 것이 아니라, 먼저 1차 캐시에 저장됩니다. 이후 같은 엔티티를 조회할 때는 DB가 아닌 캐시에서 바로 조회하게 되어 성능을 높일 수 있습니다.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/389d6e8c4535f17a8b49481135e02460/b0f6f/image-2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.8235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABLUlEQVR42oWSi66CQAxE/f//4hcAhUAwvF8i4Y3am9NkiVGTazJp122nM1tO8vF7PB7Stq3cbjdF0zSSpqkkSaLxPa+qSmu6rpOyLGXbNjl9Eq7rqoTzPCvIbdtWXC4X8TxPHMeR8/msJKaurmtZluWbkCmQTNMk4zhqZAjF5IbAYBiG34Sv1+snIQ1YwiYWUZZlmVq+3+/fhBA9n8+DEDW8i1FAXhSF2jRvF4ahWJYlURQdtg9CirkAcRyrOpooADTzv+/7etf3vdYywCwGNwfhvu/HG7FhLDAVOxRdr1dVxmDO5Nxz5gv4UpjnuU5HCTmEbNN1XQmCQFWggGcBDDLDAaQQEpWQApqYyEJQTA54fGPdAEXYNGeIEEH9seX3pRCNFRqJ/wEyRPFh/wGpTPeLxncs1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 2' title='' src='/static/389d6e8c4535f17a8b49481135e02460/ca1dc/image-2.png' srcset='/static/389d6e8c4535f17a8b49481135e02460/e7570/image-2.png 170w,\n/static/389d6e8c4535f17a8b49481135e02460/f46e7/image-2.png 340w,\n/static/389d6e8c4535f17a8b49481135e02460/ca1dc/image-2.png 680w,\n/static/389d6e8c4535f17a8b49481135e02460/02d09/image-2.png 1020w,\n/static/389d6e8c4535f17a8b49481135e02460/b0f6f/image-2.png 1042w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3 id=\"동일성-보장\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9D%BC%EC%84%B1-%EB%B3%B4%EC%9E%A5\" aria-label=\"동일성 보장 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>동일성 보장</h3>\n<p>영속성 컨텍스트는 동일성을 보장합니다. 동일한 트랜잭션 내에서 같은 엔티티를 조회하면, == 비교로도 동일한 객체임을 확인할 수 있습니다. 즉, 동일한 엔티티는 트랜잭션 내에서 같은 인스턴스로 관리됩니다.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/e0fcb1b3054677b88f545a1525bf58bc/f6540/image-3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 18.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABJ0AAASdAHeZh94AAAA6klEQVR42j2OS4+CQBCE+f//aT2sBxMxAXZ1gECQpyiPGXAGEk/fDhz2UOnuSlV1OWEYUpUVfd+jlKIoCpIkwfM8hBCEoeB2u1E3zT+flyWf+Y1Jc0ySs9Ytc/tkGCXO+XwmjiJrqPfQzfx7vfJ9POK6LheL0+lEkqb8BAGHwxdXEfLRBu0LtCdY0xLZPHjYUGdrNc8zxhiWZdl3pSbGcbT7tN9Syn1u2HilJOu6skwTi9WuWu/eLcNJ7ec4jsmyjPx+x/d9Agvf84ksv7UehoG6qnh1nQ1aeD4b2rZGzZJ+7ND6bXUvtNH8Ab8XJQqFfGrDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 3' title='' src='/static/e0fcb1b3054677b88f545a1525bf58bc/ca1dc/image-3.png' srcset='/static/e0fcb1b3054677b88f545a1525bf58bc/e7570/image-3.png 170w,\n/static/e0fcb1b3054677b88f545a1525bf58bc/f46e7/image-3.png 340w,\n/static/e0fcb1b3054677b88f545a1525bf58bc/ca1dc/image-3.png 680w,\n/static/e0fcb1b3054677b88f545a1525bf58bc/02d09/image-3.png 1020w,\n/static/e0fcb1b3054677b88f545a1525bf58bc/f6540/image-3.png 1063w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3 id=\"트랜잭션을-지원하는-쓰기-지연\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%84-%EC%A7%80%EC%9B%90%ED%95%98%EB%8A%94-%EC%93%B0%EA%B8%B0-%EC%A7%80%EC%97%B0\" aria-label=\"트랜잭션을 지원하는 쓰기 지연 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>트랜잭션을 지원하는 쓰기 지연</h3>\n<p>엔티티를 여러 번 저장할 때마다 DB에 쿼리가 바로 실행되지 않습니다. 영속성 컨텍스트에 저장된 SQL 쿼리들은 쓰기 지연 SQL 저장소에 모아두고, 트랜잭션 커밋 시 한꺼번에 DB로 전송됩니다. 이 덕분에 성능이 향상됩니다.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/df09bb3c40bc7f7a726d648b09ba0f5f/0ae55/image-4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 47.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAAB0ElEQVR42mVS227iUAzM/38Q7ENZ8YCaRYQEQiDkfifkAgVUAmQrTW3vtup2Hyw70fF4PGMljCJs7A1WKxOO4yIMA+z3e+RZBtd14fs+XM+Ds90iSRLY9Nbe2LAsC0EQoMhznM9nXCi66xXKfK5jvV5D02YUGra2TeArAZtOp1LPZjOYpgnP82EYBp5VFfO5Bl3XEYQhiqJAmqQ4nc5Q+Cez4Mmu48AhIItA4jhGmiZo24aY+FhbJqKIm3PaIkTbNKirCo/HneKB+/2O2+0GpW1aHI9HvLycaMIJDT3kfLlc8Pb2G13XUVxxvb5K5uBGBuHoqL7dOvkngB4xMs0llsulrM6MVVppsTCwJd24qe/7T4C+f3zWH6y+hvJzNMKP4RCTyQTj8RiD4QCDwRCj0ZNomOeFmNS2LQ6HA+q6lsybsBnfQZWYXE7TFBXpwYwyqjNy2HM9Edul7PsBAWfY7UpyOpb/gVxD9T8gC7/fl8TggJYm8+Po7xBuYCb8pqZclqUM2+12ckLf1xXAX6QXr8tnYxgLOZMnWld9VuXW2G12l5mZpk7aalI7zgZVXf4xpvtiCq/Kk1mjSvRphQF/s/vsNpvCTew0x4err1L/y/Adqh7eO/zX97IAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 4' title='' src='/static/df09bb3c40bc7f7a726d648b09ba0f5f/ca1dc/image-4.png' srcset='/static/df09bb3c40bc7f7a726d648b09ba0f5f/e7570/image-4.png 170w,\n/static/df09bb3c40bc7f7a726d648b09ba0f5f/f46e7/image-4.png 340w,\n/static/df09bb3c40bc7f7a726d648b09ba0f5f/ca1dc/image-4.png 680w,\n/static/df09bb3c40bc7f7a726d648b09ba0f5f/02d09/image-4.png 1020w,\n/static/df09bb3c40bc7f7a726d648b09ba0f5f/0ae55/image-4.png 1121w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/f25a44cf75045f27356577f08875e132/0bbcd/image-5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 76.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABJ0AAASdAHeZh94AAABmUlEQVR42o2TC4+CQAyE+f+/z4SogIigoMjDByKoPb6eJXeXi0rSlF2605np4vR9L9drK23bDvkql0szxEVut5vwra5rOR6PGqvVSpbLpYRhKEmSyOFw0O/kx+MhPE5dVVpEcbJeix/4EiwWUhSFdF2nxTQj53ku+/1ec1mW2qQazrN3v9+/AeXFk6apzGYzbRjHsayHhjADkIZBEIzgKAL0JeD5fNYDBOAwaZpG93e7nQIi2Vhut9vXgHiKVDwlw5SAJYzJ0+lUwaiB9UeAMDqdTpoJ2CITljRgPQ6FxOJv/AQ0mZYZBu/GHmYfDQXALMs08IcMm81mowOyjGR7HLrgBR/SNJPo6ROSuq4fGWI894/wPE/rYctQfjFsB8oUcxApZVnoGil0BhyvaABDWLFPDfu88+2tZHw0wCiKVAWyATIw13V1H5YQYHDOfwOxwEOKCPPQGOGl7/sqnQbcVa7S26FQbBMFhEP6mz7v4mQy0UZI5m/5+GIDyppBAMAgaDCfz9XX8R6+A0Sq/X4E3gEAGHLxmAYG+AXFcX/miHlWsQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 5' title='' src='/static/f25a44cf75045f27356577f08875e132/ca1dc/image-5.png' srcset='/static/f25a44cf75045f27356577f08875e132/e7570/image-5.png 170w,\n/static/f25a44cf75045f27356577f08875e132/f46e7/image-5.png 340w,\n/static/f25a44cf75045f27356577f08875e132/ca1dc/image-5.png 680w,\n/static/f25a44cf75045f27356577f08875e132/0bbcd/image-5.png 820w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/6ae083166c5abce30b865dee156c5fe1/e9ffe/image-6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 68.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAABvUlEQVR42nWT2W7CQAxF8/9/RF9pqyKBGgqEsIp9XwIJSUAUN8dloimiI5lkJvbxtcc4cl+3202fXqMhpdJHZiUpFotSKZelXK6I77ekVvuSQuFFXt/exXU/ZT6fSZykYi+Hn+v1mlsYhnI4HNT2+71EUSTH41GO2XkQ7GWxWMhut9Oz0+mUxXz/BZ7PZ1mv1+oEgIBGprLVakm32xXP86Tdbmdq5hJmcBLgB+zZctI0VYc4jtVQuNls8iQ8jSq+AYru4KdAFCL/crmoM1CSYNvtVg0QANpgEhiF+AVBoCJ4d3hxXVfLMn0hONSeBZIkiULxoxLO2RsgPrSmWq1qFQ7B0+k0LwsARiB7o0wvJjOgnGOmNfS7Xq//Au2STf8mk4meAeLs0YAul8sc7vt+DlcgG8pA+mw2k8FgIP1+X5rNpp7bYEo17WDMmF98qAo/B2WQV6uVAsmMA+MCkFbgyGUBM0DGiFaNx+NcHc8cSCBOZEZlp9PRBJQP0IwKQLO3F0oxBaIIINnoHWp7vZ4acILNZTEaBvz4t9U5BEiQbagajUYyHA61LNpAEmMk/3ewodvTb5dmz+SjcSHPgD8JICgZ2PZMcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 6' title='' src='/static/6ae083166c5abce30b865dee156c5fe1/ca1dc/image-6.png' srcset='/static/6ae083166c5abce30b865dee156c5fe1/e7570/image-6.png 170w,\n/static/6ae083166c5abce30b865dee156c5fe1/f46e7/image-6.png 340w,\n/static/6ae083166c5abce30b865dee156c5fe1/ca1dc/image-6.png 680w,\n/static/6ae083166c5abce30b865dee156c5fe1/e9ffe/image-6.png 707w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2 id=\"영속성-컨텍스트의-상태-DB와-동기화-하기---플러시Flush\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%EC%83%81%ED%83%9C-DB%EC%99%80-%EB%8F%99%EA%B8%B0%ED%99%94-%ED%95%98%EA%B8%B0---%ED%94%8C%EB%9F%AC%EC%8B%9CFlush\" aria-label=\"영속성 컨텍스트의 상태 DB와 동기화 하기   플러시Flush permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>영속성 컨텍스트의 상태 DB와 동기화 하기 - 플러시(Flush)</h2>\n<p>플러시(Flush)는 영속성 컨텍스트의 상태를 DB와 동기화하는 작업입니다.</p>\n<h3 id=\"플러시가-발생할-때\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%9F%AC%EC%8B%9C%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%95%A0-%EB%95%8C\" aria-label=\"플러시가 발생할 때 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>플러시가 발생할 때</h3>\n<p>이때 플러시가 발생하면 다음과 같은 작업들이 이루어집니다.</p>\n<p><strong>1. 변경 감지 (Dirty Checking)</strong> : 영속성 컨텍스트에 저장된 엔티티들이 변경되었는지 확인합니다.</p>\n<p><strong>2. 수정된 엔티티를 쓰기 지연 SQL 저장소에 등록</strong> : 변경된 엔티티가 있으면 그에 해당하는 UPDATE 쿼리를 생성하여 쓰기 지연 SQL 저장소에 등록합니다.</p>\n<p><strong>3. 쓰기 지연 SQL 저장소의 쿼리를 DB에 전송</strong> : 플러시 시점에 쓰기 지연 SQL 저장소에 저장된 등록, 수정, 삭제 쿼리들을 데이터베이스로 전송해 실제로 DB에 반영합니다.</p>\n<h3 id=\"플러시를-발생시키는-방법\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%9F%AC%EC%8B%9C%EB%A5%BC-%EB%B0%9C%EC%83%9D%EC%8B%9C%ED%82%A4%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"플러시를 발생시키는 방법 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>플러시를 발생시키는 방법</h3>\n<p><strong>1. em.flush() 호출</strong> : 영속성 컨텍스트를 수동으로 플러시하고 싶을 때 직접 호출할 수 있습니다.</p>\n<p><strong>2. 트랜잭션 커밋</strong> : 트랜잭션이 커밋되는 시점에 JPA가 자동으로 플러시를 실행합니다. 이때 변경 사항들이 DB에 반영됩니다.</p>\n<p><strong>3. JPQL 쿼리 실행</strong> : JPQL을 실행할 때도 자동으로 플러시가 호출됩니다. 이는 JPQL로 조회할 때, 영속성 컨텍스트에 있는 최신 상태의 엔티티가 반영되어야 하기 때문입니다. 예를 들어, em.persist()로 엔티티를 영속성 컨텍스트에 등록한 후, JPQL을 실행하면 DB에 반영된 상태에서 조회를 해야 하므로 플러시가 발생합니다.</p>\n<h3 id=\"플러시의-특징\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%9F%AC%EC%8B%9C%EC%9D%98-%ED%8A%B9%EC%A7%95\" aria-label=\"플러시의 특징 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>플러시의 특징</h3>\n<p><strong>1. 영속성 컨텍스트를 비우지 않음</strong> : 플러시는 단순히 변경 내용을 DB에 동기화할 뿐, 영속성 컨텍스트 자체를 비우지는 않습니다. 즉, 플러시 이후에도 영속성 컨텍스트는 유지됩니다.</p>\n<p><strong>2. 트랜잭션과의 관계</strong> : 트랜잭션의 작업 단위가 중요하며, DB와의 동기화는 보통 커밋 직전에만 일어나면 충분합니다. 이는 트랜잭션의 일관성을 유지하기 위해 중요한 메커니즘입니다.</p>\n<h2 id=\"그렇다면-ID로-다시-조회해야-할까\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-ID%EB%A1%9C-%EB%8B%A4%EC%8B%9C-%EC%A1%B0%ED%9A%8C%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C\" aria-label=\"그렇다면 ID로 다시 조회해야 할까 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>그렇다면 ID로 다시 조회해야 할까?</h2>\n<p>영속성 컨텍스트는 트랜잭션 내에서 동일한 엔티티의 동일성을 보장하지만, 트랜잭션 범위 밖에서는 보장되지 않기 때문에 ID로 다시 조회해야 합니다. 트랜잭션이 종료되면 영속성 컨텍스트는 더 이상 엔티티를 관리하지 않기 때문에 새로운 트랜잭션 내에서 엔티티를 조회할 필요가 있습니다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>마치며</h2>\n<p>저랑 비슷한 궁금증이 있으셨던 분들이 이 글을 통해 도움이 되셨으면 좋겠습니다. 읽어주셔서 감사드리고, 잘못된 부분이 있으면 댓글 남겨주세요.</p>\n<p>reference : <a href=\"https://www.inflearn.com/course/lecture?courseSlug=ORM-JPA-Basic\">https://www.inflearn.com/course/lecture?courseSlug=ORM-JPA-Basic</a></p>","frontmatter":{"title":"JPA에서 객체 변경 시 save() 호출이 필요할까? - 영속성 컨텍스트의 힘","date":"October 04, 2024","update":"October 04, 2024","tags":["JPA","Persistence context"],"series":null},"fields":{"slug":"/jpa1/","readingTime":{"minutes":8.055}}},"seriesList":{"edges":[{"node":{"id":"926b5e59-e6c2-5645-8db2-7def69c806e4","fields":{"slug":"/jpa1/"},"frontmatter":{"title":"JPA에서 객체 변경 시 save() 호출이 필요할까? - 영속성 컨텍스트의 힘"}}},{"node":{"id":"74d7f977-0c43-5125-9015-fd329e897958","fields":{"slug":"/about/"},"frontmatter":{"title":"This is about page ✋"}}}]},"previous":{"fields":{"slug":"/groomthon_study/"},"frontmatter":{"title":"예측모델 기반 face detection 웹서비스 구현"}},"next":null},"pageContext":{"id":"926b5e59-e6c2-5645-8db2-7def69c806e4","series":null,"previousPostId":"581d4e78-0d4c-5286-8bab-a61eeed9095b","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}